server:
  port: 8080
  servlet:
    context-path: /api

spring:
  application:
    name: hr-ai-agent-core

  # 数据源配置
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/hr_ai_saas?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: root
    password: hr_ai_2025  # Docker Compose 默认密码
    druid:
      initial-size: 5
      min-idle: 5
      max-active: 20
      max-wait: 60000
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      validation-query: SELECT 1
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000

  # ========== Kafka 消息队列 ==========
  kafka:
    bootstrap-servers: ${KAFKA_SERVERS:localhost:9092}
    producer:
      acks: all
      retries: 3
      batch-size: 16384
      buffer-memory: 33554432
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      properties:
        enable.idempotence: true
        max.in.flight.requests.per.connection: 5
    consumer:
      group-id: hr-ai-agent-group
      auto-offset-reset: earliest
      enable-auto-commit: false
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: com.hrai.*
        max.poll.records: 100
    listener:
      ack-mode: manual_immediate
      concurrency: 3

  # Redis 配置 (通过 Redisson)
  redis:
    redisson:
      config: |
        singleServerConfig:
          address: "redis://localhost:6379"
          password: null
          database: 0
          connectionPoolSize: 50
          connectionMinimumIdleSize: 10
          timeout: 3000

  # Jackson 配置
  jackson:
    time-zone: GMT+8
    date-format: yyyy-MM-dd HH:mm:ss
    serialization:
      write-dates-as-timestamps: false

  # ========== Spring AI Alibaba 配置 ==========
  ai:
    dashscope:
      api-key: ${DASHSCOPE_API_KEY:sk-your-api-key}
      # 聊天模型配置
      chat:
        options:
          model: qwen-plus  # 可选: qwen-turbo, qwen-plus, qwen-max
          temperature: 0.7
          top-p: 0.8
          max-tokens: 2000
      # 嵌入模型配置
      embedding:
        options:
          model: text-embedding-v2  # 768维向量

    # Milvus 向量存储 (Spring AI 集成)
    vectorstore:
      milvus:
        host: ${MILVUS_HOST:localhost}
        port: ${MILVUS_PORT:19530}
        collection-name: hr_knowledge
        embedding-dimension: 768
        index-type: IVF_FLAT
        metric-type: COSINE

    # ========== MCP 配置 - 工具动态注册与发现 ==========
    alibaba:
      mcp:
        nacos:
          server-addr: ${NACOS_SERVER_ADDR:localhost:8848}
          namespace: ${NACOS_NAMESPACE:public}
          group: MCP_GROUP
          username: ${NACOS_USERNAME:nacos}
          password: ${NACOS_PASSWORD:nacos}
          # MCP Server - 工具注册
          server:
            enabled: true
            name: hr-ai-mcp-server
            description: HR AI Agent 工具服务
          # MCP Client - 外部工具发现
          client:
            enabled: true
            # 外部 MCP Server 接入 (IDE 插件、浏览器扩展等)
            external-servers: []

      # ========== A2A 协议 - Agent 间任务委派 ==========
      a2a:
        server:
          enabled: true
          name: hr-ai-agent
          description: HR AI SaaS 主 Agent 服务
          skills:
            - name: hr-policy
              description: HR 政策咨询
            - name: recruiting
              description: 招聘流程管理
            - name: ticket-routing
              description: 工单路由分发
        nacos:
          discovery:
            enabled: true
            server-addr: ${NACOS_SERVER_ADDR:localhost:8848}
            namespace: ${NACOS_NAMESPACE:public}
            group: A2A_GROUP

# MyBatis Plus 配置
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      logic-delete-field: deleted  # 逻辑删除字段
      logic-delete-value: 1
      logic-not-delete-value: 0
  mapper-locations: classpath*:/mapper/**/*.xml

# ========== Milvus 向量数据库配置 (原生 SDK) ==========
milvus:
  host: ${MILVUS_HOST:localhost}
  port: ${MILVUS_PORT:19530}
  username: ${MILVUS_USERNAME:}
  password: ${MILVUS_PASSWORD:}
  # Collection 定义
  collections:
    knowledge:
      name: hr_knowledge
      dimension: 768
      index-type: IVF_FLAT
      metric-type: COSINE
      description: HR 知识库向量存储
    memory:
      name: user_memory
      dimension: 768
      index-type: IVF_FLAT
      metric-type: COSINE
      description: 用户长期记忆向量存储

# Agent 配置
agent:
  # 默认配置
  default:
    max-iterations: 5  # ReAct 最大迭代次数
    temperature: 0.7
    max-tokens: 2000
  # RAG 配置
  rag:
    top-k: 5  # 检索Top K文档
    score-threshold: 0.6  # 相似度阈值
    chunk-size: 500  # 文档分块大小
    chunk-overlap: 50  # 分块重叠
  # 记忆配置
  memory:
    short-term:
      max-history: 10  # 最多保存10轮对话
      ttl: 3600  # 1小时过期 (秒)
    long-term:
      enabled: true
      vector-store: true  # 是否向量化存储

# Actuator 健康检查配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true

# 日志配置
logging:
  level:
    root: INFO
    com.hrai: DEBUG
    org.springframework.ai: DEBUG
    com.alibaba.cloud.ai: DEBUG
    io.milvus: INFO
    org.apache.kafka: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
