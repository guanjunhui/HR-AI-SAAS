# 更换技术栈 - 需求

状态: draft
负责人:
最后更新: 2026-01-29

## 目标
- 统一并升级基础设施：消息队列切换为 Kafka，向量库切换为 Milvus。
- 升级 Spring AI Alibaba 至 1.1.0.0-RC2，并接入 spring-ai-alibaba-agent-framework 与 graph 能力。
- 接入 Nacos，实现 MCP 注册/发现，并为后续 A2A 注册发现预留扩展位。
- 保持核心业务功能不回退，配置可控、可回滚。

## 背景
- 现有消息队列与向量库方案需要统一到更主流/可扩展的基础设施。
- 需要引入 Spring AI Alibaba 最新能力以支持 agent framework 与 graph。
- MCP 与后续 A2A 的注册发现需要统一注册中心（Nacos）支撑。

## 用户/干系人
- 平台/基础设施团队
- 后端服务开发团队
- AI 相关业务/产品负责人

## 范围
### 包含
- 消息队列从现有方案切换到 Kafka（生产/消费/Topic 规范）。
- 向量库从现有方案切换到 Milvus（建库、写入、检索、索引）。
- Spring AI Alibaba 依赖升级到 1.1.0.0-RC2，并接入 agent-framework 与 graph。
- 接入 Nacos：服务注册、MCP 能力注册、服务发现与配置接入。
- 迁移方案与灰度策略、配置开关、回滚路径。
- 配套文档与运维配置说明。

### 不包含
- 新业务功能开发或业务流程重构。
- A2A 完整协议实现（仅预留注册发现扩展能力）。
- 非必要的 UI/前端改造。

## 功能需求
- 必须: 
  - Kafka 生产/消费链路可用，支持现有消息语义与关键 Topic。
  - Milvus 写入、检索与索引能力可用，替代现有向量库。
  - Spring AI Alibaba 版本升级成功，agent-framework 与 graph 可被调用。
  - Nacos 完成 MCP 注册与发现；服务启动与下线时注册状态正确。
  - 关键配置可通过配置中心/环境变量管理，并可回滚到旧方案（如双写/开关）。
- 应该: 
  - 支持本地/测试环境一键启动最小依赖（Kafka/Milvus/Nacos 容器化方案）。
  - 运行中可观测性完善（指标/日志/链路）。
- 可选: 
  - 双写/双读过渡期能力，降低切换风险。
  - 兼容历史向量数据的平滑迁移工具或脚本。

## 非功能需求
- 可用性：切换期间服务可用，故障可回滚。
- 性能：消息吞吐与向量检索性能不低于现有方案。
- 可维护性：配置清晰，模块边界明确。
- 安全：访问认证/鉴权、密钥管理与传输加密。

## 验收标准
- [ ] Kafka 生产/消费链路在测试环境验证通过，关键 Topic 消息完整且无丢失。
- [ ] Milvus 向量写入与检索功能验证通过，结果与现有方案对齐。
- [ ] Spring AI Alibaba 1.1.0.0-RC2 升级完成，agent-framework 与 graph 能力可用。
- [ ] Nacos 注册中心中可查看 MCP 服务注册信息，服务发现可用。
- [ ] 具备回滚/降级开关与文档说明。

## 风险/假设
- RC 版本稳定性与兼容性风险。
- 现有消息/向量数据格式与新存储兼容风险。
- 依赖系统（Kafka/Milvus/Nacos）的运维与资源保障。

## 待确认问题
- 现有消息队列与向量库类型/版本？需兼容哪些特性？
- Kafka/Milvus/Nacos 目标版本与部署方式（自建/云服务）？
- 是否需要双写/灰度切换？切换窗口与回滚策略？
- 历史向量数据是否迁移？迁移范围与时间窗口？
- MCP 注册需要暴露哪些元数据？A2A 预留的扩展字段规范？
