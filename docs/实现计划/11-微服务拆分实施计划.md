# å¾®æœåŠ¡æ‹†åˆ†å®æ–½è®¡åˆ’

> **ç‰ˆæœ¬**: v1.0.0
> **åˆ›å»ºæ—¥æœŸ**: 2026-02-02
> **æ–‡æ¡£çŠ¶æ€**: æ‰§è¡ŒæŒ‡å—

---

## ä¸€ã€å½“å‰çŠ¶æ€è¯„ä¼°

### 1.1 ç°çŠ¶åˆ†æ

| ç»´åº¦ | å½“å‰çŠ¶æ€ | ç›®æ ‡çŠ¶æ€ | å·®è· |
|------|---------|---------|------|
| Mavenæ¨¡å—æ•° | 2ä¸ªï¼ˆcommon + agent-coreï¼‰ | 12ä¸ªï¼ˆcommon + gateway + 10æœåŠ¡ï¼‰ | -10ä¸ª |
| æœåŠ¡æ‹†åˆ† | âŒ å•ä½“æ¶æ„ | âœ… 11ä¸ªç‹¬ç«‹æœåŠ¡ | 0% |
| æ•°æ®åº“éš”ç¦» | âŒ å•ä¸€æ•°æ®æº | âœ… 10ä¸ªç‹¬ç«‹åº“ | 0% |
| APIç½‘å…³ | âŒ æ—  | âœ… hr-gateway | 0% |
| Nacosé›†æˆ | âœ… ä¾èµ–å·²å¼•å…¥ | âœ… å®é™…åº”ç”¨ | 50% |
| A2Aåè®® | âœ… ä¾èµ–å·²å¼•å…¥ | âœ… å®é™…åº”ç”¨ | 30% |

### 1.2 æŠ€æœ¯å€ºåŠ¡æ¸…å•

| å€ºåŠ¡é¡¹ | ä¸¥é‡ç¨‹åº¦ | å½±å“èŒƒå›´ | é¢„ä¼°å·¥æ—¶ |
|--------|---------|---------|---------|
| Mavenæ¨¡å—æœªæ‹†åˆ† | ğŸ”´ é«˜ | æ¶æ„åŸºç¡€ | 3äººæ—¥ |
| ä¸šåŠ¡ä»£ç æœªæŒ‰æœåŠ¡åŸŸç»„ç»‡ | ğŸ”´ é«˜ | ä»£ç å¯ç»´æŠ¤æ€§ | 5äººæ—¥ |
| ç¼ºå°‘APIç½‘å…³ | ğŸ”´ é«˜ | ç»Ÿä¸€å…¥å£ | 2äººæ—¥ |
| æ•°æ®åº“æœªç‹¬ç«‹åŒ– | ğŸŸ¡ ä¸­ | æ•°æ®éš”ç¦» | 3äººæ—¥ |
| Feign Clientæœªå®ç° | ğŸŸ¡ ä¸­ | æœåŠ¡é—´é€šä¿¡ | 2äººæ—¥ |
| Kafkaäº‹ä»¶æœºåˆ¶æœªå®ç° | ğŸŸ¡ ä¸­ | å¼‚æ­¥è§£è€¦ | 2äººæ—¥ |
| **æ€»è®¡** | - | - | **17äººæ—¥** |

---

## äºŒã€æ‹†åˆ†ç­–ç•¥ä¸åŸåˆ™

### 2.1 æ‹†åˆ†åŸåˆ™

1. **ä¸šåŠ¡åŸŸé©±åŠ¨**ï¼šæŒ‰DDDé¢†åŸŸæ¨¡å‹åˆ’åˆ†æœåŠ¡è¾¹ç•Œ
2. **æ•°æ®è‡ªæ²»**ï¼šæ¯ä¸ªæœåŠ¡æ‹¥æœ‰ç‹¬ç«‹æ•°æ®åº“
3. **å‘åå…¼å®¹**ï¼šæ‹†åˆ†è¿‡ç¨‹ä¸å½±å“ç°æœ‰åŠŸèƒ½
4. **æ¸è¿›å¼æ¼”è¿›**ï¼šé‡‡ç”¨ç»æ€è€…æ¨¡å¼é€æ­¥è¿ç§»
5. **æœ€å°çˆ†ç‚¸åŠå¾„**ï¼šä¼˜å…ˆæ‹†åˆ†ä½é£é™©ã€é«˜ç‹¬ç«‹æ€§æœåŠ¡

### 2.2 æ‹†åˆ†é¡ºåºï¼ˆç»æ€è€…æ¨¡å¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç»æ€è€…æ¨¡å¼æ‹†åˆ†é¡ºåº                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Step 0: åŸºç¡€è®¾æ–½å‡†å¤‡ (hr-gateway)                          â”‚
â”‚      â†“   é£é™©ï¼šä½  |  ç‹¬ç«‹æ€§ï¼šé«˜  |  å·¥æ—¶ï¼š2å¤©                â”‚
â”‚  Step 1: hr-org-service (ç»„ç»‡æƒé™)                          â”‚
â”‚      â†“   é£é™©ï¼šä½  |  ç‹¬ç«‹æ€§ï¼šé«˜  |  å·¥æ—¶ï¼š2å¤©                â”‚
â”‚  Step 2: hr-ai-service (AIèƒ½åŠ›ä¸­å¿ƒ)                         â”‚
â”‚      â†“   é£é™©ï¼šä¸­  |  ç‹¬ç«‹æ€§ï¼šé«˜  |  å·¥æ—¶ï¼š3å¤©                â”‚
â”‚  Step 3: hr-rag-service (RAGæ£€ç´¢)                           â”‚
â”‚      â†“   é£é™©ï¼šä½  |  ç‹¬ç«‹æ€§ï¼šé«˜  |  å·¥æ—¶ï¼š2å¤©                â”‚
â”‚  Step 4: hr-core-service (Core HR)                         â”‚
â”‚      â†“   é£é™©ï¼šä¸­  |  ç‹¬ç«‹æ€§ï¼šä¸­  |  å·¥æ—¶ï¼š3å¤©                â”‚
â”‚  Step 5: hr-recruit-service (æ‹›è˜å…¥èŒ)                      â”‚
â”‚      â†“   é£é™©ï¼šä¸­  |  ç‹¬ç«‹æ€§ï¼šä¸­  |  å·¥æ—¶ï¼š3å¤©                â”‚
â”‚  Step 6: hr-attend-service (è€ƒå‹¤å‡å‹¤)                       â”‚
â”‚      â†“   é£é™©ï¼šä¸­  |  ç‹¬ç«‹æ€§ï¼šä¸­  |  å·¥æ—¶ï¼š2å¤©                â”‚
â”‚  Step 7: hr-payroll-service (è–ªé…¬è–ªèµ„)                      â”‚
â”‚      â†“   é£é™©ï¼šé«˜  |  ç‹¬ç«‹æ€§ï¼šä½  |  å·¥æ—¶ï¼š3å¤©                â”‚
â”‚  Step 8: hr-perf-service (ç»©æ•ˆç®¡ç†)                         â”‚
â”‚      â†“   é£é™©ï¼šä¸­  |  ç‹¬ç«‹æ€§ï¼šä¸­  |  å·¥æ—¶ï¼š2å¤©                â”‚
â”‚  Step 9: hr-ticket-service (å·¥å•ç³»ç»Ÿ)                       â”‚
â”‚      â†“   é£é™©ï¼šä½  |  ç‹¬ç«‹æ€§ï¼šé«˜  |  å·¥æ—¶ï¼š2å¤©                â”‚
â”‚  Step 10: hr-report-service (æŠ¥è¡¨åˆ†æ)                      â”‚
â”‚      â†“   é£é™©ï¼šä½  |  ç‹¬ç«‹æ€§ï¼šé«˜  |  å·¥æ—¶ï¼š2å¤©                â”‚
â”‚                                                             â”‚
â”‚  **æ€»å·¥æ—¶**: 26äººæ—¥ï¼ˆçº¦5-6å‘¨ï¼ŒæŒ‰1äººè®¡ï¼‰                      â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€Phase 0ï¼šåŸºç¡€è®¾æ–½å‡†å¤‡ï¼ˆç¬¬1å‘¨ï¼‰

### 3.1 ç›®æ ‡äº¤ä»˜ç‰©

- [x] APIç½‘å…³æ¨¡å—ï¼ˆhr-gatewayï¼‰
- [x] çˆ¶POMæ›´æ–°ï¼ˆmodulesé…ç½®ï¼‰
- [x] Docker Composeæ›´æ–°ï¼ˆç‹¬ç«‹æ•°æ®åº“å®ä¾‹ï¼‰
- [x] Nacosé…ç½®å‘½åç©ºé—´è§„åˆ’

### 3.2 åˆ›å»ºAPIç½‘å…³æ¨¡å—

#### 3.2.1 åˆ›å»ºç›®å½•ç»“æ„

```bash
mkdir -p hr-gateway/src/main/java/com/hrai/gateway
mkdir -p hr-gateway/src/main/resources
```

#### 3.2.2 ç¼–å†™ pom.xml

```xml
<!-- hr-gateway/pom.xml -->
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>com.hrai</groupId>
        <artifactId>hr-ai-saas</artifactId>
        <version>1.0.0-SNAPSHOT</version>
    </parent>

    <artifactId>hr-gateway</artifactId>
    <packaging>jar</packaging>
    <name>HR AI Gateway</name>
    <description>APIç½‘å…³ - ç»Ÿä¸€å…¥å£ã€è·¯ç”±ã€è®¤è¯ã€é™æµ</description>

    <dependencies>
        <!-- Spring Cloud Gateway -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-gateway</artifactId>
        </dependency>

        <!-- Nacos æœåŠ¡å‘ç° -->
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
        </dependency>

        <!-- Nacos é…ç½®ä¸­å¿ƒ -->
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
        </dependency>

        <!-- LoadBalancer -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-loadbalancer</artifactId>
        </dependency>

        <!-- Redisï¼ˆé™æµï¼‰ -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-redis-reactive</artifactId>
        </dependency>

        <!-- JWT -->
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-api</artifactId>
            <version>0.11.5</version>
        </dependency>
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-impl</artifactId>
            <version>0.11.5</version>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-jackson</artifactId>
            <version>0.11.5</version>
            <scope>runtime</scope>
        </dependency>

        <!-- Actuator -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>

        <!-- Lombok -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <scope>provided</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>
</project>
```

#### 3.2.3 å¯åŠ¨ç±»

```java
// hr-gateway/src/main/java/com/hrai/gateway/GatewayApplication.java
package com.hrai.gateway;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient
public class GatewayApplication {
    public static void main(String[] args) {
        SpringApplication.run(GatewayApplication.class, args);
    }
}
```

#### 3.2.4 é…ç½®æ–‡ä»¶

```yaml
# hr-gateway/src/main/resources/bootstrap.yml
spring:
  application:
    name: hr-gateway
  cloud:
    nacos:
      server-addr: ${NACOS_SERVER_ADDR:localhost:8848}
      discovery:
        namespace: ${NACOS_NAMESPACE:dev}
        group: HRAI_GROUP
      config:
        namespace: ${NACOS_NAMESPACE:dev}
        group: HRAI_GROUP
        file-extension: yml
```

```yaml
# hr-gateway/src/main/resources/application.yml
server:
  port: 8080

spring:
  cloud:
    gateway:
      discovery:
        locator:
          enabled: true  # å¼€å¯æœåŠ¡å‘ç°
          lower-case-service-id: true

      routes:
        # hr-org-service è·¯ç”±
        - id: hr-org-service
          uri: lb://hr-org-service
          predicates:
            - Path=/api/org/**
          filters:
            - StripPrefix=1
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 100
                redis-rate-limiter.burstCapacity: 200

        # hr-core-service è·¯ç”±
        - id: hr-core-service
          uri: lb://hr-core-service
          predicates:
            - Path=/api/hr/**
          filters:
            - StripPrefix=1

        # hr-ai-service è·¯ç”±
        - id: hr-ai-service
          uri: lb://hr-ai-service
          predicates:
            - Path=/api/ai/**
          filters:
            - StripPrefix=1

      # å…¨å±€CORSé…ç½®
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
            allowedHeaders: "*"
            allowCredentials: true

  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    database: 0

management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway
```

#### 3.2.5 JWTè®¤è¯è¿‡æ»¤å™¨

```java
// hr-gateway/src/main/java/com/hrai/gateway/filter/AuthGlobalFilter.java
package com.hrai.gateway.filter;

import io.jsonwebtoken.Claims;
import io.jsonwebtoken.Jwts;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.cloud.gateway.filter.GatewayFilterChain;
import org.springframework.cloud.gateway.filter.GlobalFilter;
import org.springframework.core.Ordered;
import org.springframework.http.HttpStatus;
import org.springframework.http.server.reactive.ServerHttpRequest;
import org.springframework.stereotype.Component;
import org.springframework.web.server.ServerWebExchange;
import reactor.core.publisher.Mono;

@Slf4j
@Component
public class AuthGlobalFilter implements GlobalFilter, Ordered {

    @Value("${jwt.secret:hr-ai-secret-key-2025}")
    private String jwtSecret;

    private static final String[] WHITE_LIST = {
        "/api/org/auth/login",
        "/api/health",
        "/actuator/**"
    };

    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        String path = exchange.getRequest().getURI().getPath();

        // ç™½åå•æ”¾è¡Œ
        for (String pattern : WHITE_LIST) {
            if (path.matches(pattern.replace("**", ".*"))) {
                return chain.filter(exchange);
            }
        }

        // JWTéªŒè¯
        String token = exchange.getRequest().getHeaders().getFirst("Authorization");
        if (token == null || !token.startsWith("Bearer ")) {
            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
            return exchange.getResponse().setComplete();
        }

        try {
            token = token.substring(7);
            Claims claims = Jwts.parserBuilder()
                .setSigningKey(jwtSecret.getBytes())
                .build()
                .parseClaimsJws(token)
                .getBody();

            // æå–ç§Ÿæˆ·ä¿¡æ¯å¹¶ä¼ é€’åˆ°ä¸‹æ¸¸æœåŠ¡
            ServerHttpRequest request = exchange.getRequest().mutate()
                .header("X-Tenant-Id", claims.get("tenant_id", String.class))
                .header("X-User-Id", claims.get("user_id", String.class))
                .build();

            return chain.filter(exchange.mutate().request(request).build());

        } catch (Exception e) {
            log.error("JWTéªŒè¯å¤±è´¥: {}", e.getMessage());
            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
            return exchange.getResponse().setComplete();
        }
    }

    @Override
    public int getOrder() {
        return -100;
    }
}
```

### 3.3 æ›´æ–°çˆ¶POM

```xml
<!-- pom.xmlï¼ˆæ ¹ç›®å½•ï¼‰ -->
<modules>
    <module>hr-ai-common</module>
    <module>hr-gateway</module>           <!-- æ–°å¢ -->
    <module>hr-ai-agent-core</module>     <!-- å°†é€æ­¥åºŸå¼ƒ -->
    <!-- å¾…æ·»åŠ çš„æœåŠ¡æ¨¡å— -->
    <!--
    <module>hr-org-service</module>
    <module>hr-core-service</module>
    <module>hr-recruit-service</module>
    <module>hr-attend-service</module>
    <module>hr-payroll-service</module>
    <module>hr-perf-service</module>
    <module>hr-ticket-service</module>
    <module>hr-report-service</module>
    <module>hr-ai-service</module>
    <module>hr-rag-service</module>
    -->
</modules>
```

### 3.4 æ›´æ–° Docker Compose

```yaml
# docker-compose.ymlï¼ˆè¡¥å……ç‹¬ç«‹æ•°æ®åº“å®ä¾‹ï¼‰
services:
  # ========== æ•°æ®åº“é›†ç¾¤ ==========
  mysql-org:
    image: mysql:8.0
    container_name: hr-mysql-org
    environment:
      MYSQL_ROOT_PASSWORD: hr_ai_2025
      MYSQL_DATABASE: hr_org
    ports:
      - "3307:3306"
    volumes:
      - mysql-org-data:/var/lib/mysql
    networks:
      - hrai-network

  mysql-core:
    image: mysql:8.0
    container_name: hr-mysql-core
    environment:
      MYSQL_ROOT_PASSWORD: hr_ai_2025
      MYSQL_DATABASE: hr_core
    ports:
      - "3308:3306"
    volumes:
      - mysql-core-data:/var/lib/mysql
    networks:
      - hrai-network

  mysql-recruit:
    image: mysql:8.0
    container_name: hr-mysql-recruit
    environment:
      MYSQL_ROOT_PASSWORD: hr_ai_2025
      MYSQL_DATABASE: hr_recruit
    ports:
      - "3309:3306"
    volumes:
      - mysql-recruit-data:/var/lib/mysql
    networks:
      - hrai-network

  mysql-attend:
    image: mysql:8.0
    container_name: hr-mysql-attend
    environment:
      MYSQL_ROOT_PASSWORD: hr_ai_2025
      MYSQL_DATABASE: hr_attend
    ports:
      - "3310:3306"
    volumes:
      - mysql-attend-data:/var/lib/mysql
    networks:
      - hrai-network

  mysql-payroll:
    image: mysql:8.0
    container_name: hr-mysql-payroll
    environment:
      MYSQL_ROOT_PASSWORD: hr_ai_2025
      MYSQL_DATABASE: hr_payroll
    ports:
      - "3311:3306"
    volumes:
      - mysql-payroll-data:/var/lib/mysql
    networks:
      - hrai-network

  mysql-perf:
    image: mysql:8.0
    container_name: hr-mysql-perf
    environment:
      MYSQL_ROOT_PASSWORD: hr_ai_2025
      MYSQL_DATABASE: hr_perf
    ports:
      - "3312:3306"
    volumes:
      - mysql-perf-data:/var/lib/mysql
    networks:
      - hrai-network

  mysql-ticket:
    image: mysql:8.0
    container_name: hr-mysql-ticket
    environment:
      MYSQL_ROOT_PASSWORD: hr_ai_2025
      MYSQL_DATABASE: hr_ticket
    ports:
      - "3313:3306"
    volumes:
      - mysql-ticket-data:/var/lib/mysql
    networks:
      - hrai-network

  mysql-report:
    image: mysql:8.0
    container_name: hr-mysql-report
    environment:
      MYSQL_ROOT_PASSWORD: hr_ai_2025
      MYSQL_DATABASE: hr_report
    ports:
      - "3314:3306"
    volumes:
      - mysql-report-data:/var/lib/mysql
    networks:
      - hrai-network

  mysql-ai:
    image: mysql:8.0
    container_name: hr-mysql-ai
    environment:
      MYSQL_ROOT_PASSWORD: hr_ai_2025
      MYSQL_DATABASE: hr_ai
    ports:
      - "3315:3306"
    volumes:
      - mysql-ai-data:/var/lib/mysql
    networks:
      - hrai-network

  mysql-rag:
    image: mysql:8.0
    container_name: hr-mysql-rag
    environment:
      MYSQL_ROOT_PASSWORD: hr_ai_2025
      MYSQL_DATABASE: hr_rag
    ports:
      - "3316:3306"
    volumes:
      - mysql-rag-data:/var/lib/mysql
    networks:
      - hrai-network

  # ========== ç½‘å…³æœåŠ¡ ==========
  hr-gateway:
    build: ./hr-gateway
    container_name: hr-gateway
    ports:
      - "8080:8080"
    environment:
      SPRING_PROFILES_ACTIVE: dev
      NACOS_SERVER_ADDR: nacos:8848
      REDIS_HOST: redis
    networks:
      - hrai-network
    depends_on:
      - nacos
      - redis

volumes:
  mysql-org-data:
  mysql-core-data:
  mysql-recruit-data:
  mysql-attend-data:
  mysql-payroll-data:
  mysql-perf-data:
  mysql-ticket-data:
  mysql-report-data:
  mysql-ai-data:
  mysql-rag-data:
```

### 3.5 Nacoså‘½åç©ºé—´è§„åˆ’

```bash
# åœ¨ Nacos æ§åˆ¶å°åˆ›å»ºå‘½åç©ºé—´
http://localhost:8848/nacos

# åˆ›å»ºå‘½åç©ºé—´
1. dev   - å¼€å‘ç¯å¢ƒ
2. test  - æµ‹è¯•ç¯å¢ƒ
3. prod  - ç”Ÿäº§ç¯å¢ƒ

# åˆ›å»ºé…ç½®åˆ†ç»„
HRAI_GROUP - HR AI SaaS æœåŠ¡ç»„
```

---

## å››ã€Phase 1-10ï¼šæœåŠ¡é€ä¸ªæ‹†åˆ†

### 4.1 é€šç”¨æ‹†åˆ†æ¨¡æ¿

æ¯ä¸ªæœåŠ¡çš„æ‹†åˆ†éµå¾ªä»¥ä¸‹æ ‡å‡†æµç¨‹ï¼š

#### 4.1.1 ç›®å½•ç»“æ„åˆ›å»º

```bash
# ä»¥ hr-org-service ä¸ºä¾‹
mkdir -p hr-org-service/src/main/java/com/hrai/org
mkdir -p hr-org-service/src/main/resources
mkdir -p hr-org-service/src/test/java/com/hrai/org
```

#### 4.1.2 pom.xmlæ¨¡æ¿

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project>
    <parent>
        <groupId>com.hrai</groupId>
        <artifactId>hr-ai-saas</artifactId>
        <version>1.0.0-SNAPSHOT</version>
    </parent>

    <artifactId>hr-org-service</artifactId>
    <name>HR Org Service</name>
    <description>ç»„ç»‡ä¸æƒé™æœåŠ¡</description>

    <dependencies>
        <!-- å…¬å…±æ¨¡å— -->
        <dependency>
            <groupId>com.hrai</groupId>
            <artifactId>hr-ai-common</artifactId>
            <version>${project.version}</version>
        </dependency>

        <!-- Spring Boot Web -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- Nacos -->
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
        </dependency>
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
        </dependency>

        <!-- æ•°æ®åº“ -->
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
        </dependency>
        <dependency>
            <groupId>com.mysql</groupId>
            <artifactId>mysql-connector-j</artifactId>
        </dependency>
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid-spring-boot-3-starter</artifactId>
        </dependency>

        <!-- Redis -->
        <dependency>
            <groupId>org.redisson</groupId>
            <artifactId>redisson-spring-boot-starter</artifactId>
        </dependency>

        <!-- OpenFeignï¼ˆæœåŠ¡é—´è°ƒç”¨ï¼‰ -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-openfeign</artifactId>
        </dependency>

        <!-- Kafka -->
        <dependency>
            <groupId>org.springframework.kafka</groupId>
            <artifactId>spring-kafka</artifactId>
        </dependency>

        <!-- Actuator -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>
    </dependencies>
</project>
```

#### 4.1.3 å¯åŠ¨ç±»æ¨¡æ¿

```java
package com.hrai.org;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.cloud.openfeign.EnableFeignClients;

@SpringBootApplication
@EnableDiscoveryClient
@EnableFeignClients(basePackages = "com.hrai.org.client")
@MapperScan("com.hrai.org.mapper")
public class OrgServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrgServiceApplication.class, args);
    }
}
```

#### 4.1.4 é…ç½®æ–‡ä»¶æ¨¡æ¿

```yaml
# bootstrap.yml
spring:
  application:
    name: hr-org-service
  cloud:
    nacos:
      server-addr: ${NACOS_SERVER_ADDR:localhost:8848}
      discovery:
        namespace: ${NACOS_NAMESPACE:dev}
        group: HRAI_GROUP
      config:
        namespace: ${NACOS_NAMESPACE:dev}
        group: HRAI_GROUP
        file-extension: yml
```

```yaml
# application.yml
server:
  port: 8081

spring:
  datasource:
    url: jdbc:mysql://${MYSQL_HOST:localhost}:3307/hr_org?useSSL=false&serverTimezone=Asia/Shanghai
    username: ${MYSQL_USER:root}
    password: ${MYSQL_PASSWORD:hr_ai_2025}
    driver-class-name: com.mysql.cj.jdbc.Driver
    druid:
      initial-size: 5
      min-idle: 5
      max-active: 20

  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    database: 1

mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
  type-aliases-package: com.hrai.org.entity
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
```

### 4.2 æœåŠ¡æ‹†åˆ†æ£€æŸ¥æ¸…å•

æ¯ä¸ªæœåŠ¡æ‹†åˆ†å®Œæˆåï¼Œå¿…é¡»éªŒè¯ä»¥ä¸‹æ¸…å•ï¼š

- [ ] **Mavenç¼–è¯‘é€šè¿‡** - `mvn clean compile`
- [ ] **æœåŠ¡å¯åŠ¨æˆåŠŸ** - æ—¥å¿—æ— ERROR
- [ ] **Nacosæ³¨å†ŒæˆåŠŸ** - Nacosæ§åˆ¶å°å¯è§æœåŠ¡å®ä¾‹
- [ ] **å¥åº·æ£€æŸ¥é€šè¿‡** - `curl http://localhost:808x/actuator/health`
- [ ] **æ•°æ®åº“è¿æ¥æ­£å¸¸** - å¯åŠ¨æ—¥å¿—æ˜¾ç¤ºæ•°æ®æºåˆå§‹åŒ–æˆåŠŸ
- [ ] **APIç½‘å…³è·¯ç”±æ­£å¸¸** - é€šè¿‡ç½‘å…³è°ƒç”¨æœåŠ¡APIæˆåŠŸ
- [ ] **æ—¥å¿—è¾“å‡ºè§„èŒƒ** - åŒ…å« traceIdã€tenantId
- [ ] **å•å…ƒæµ‹è¯•é€šè¿‡** - `mvn test`

---

## äº”ã€éªŒæ”¶æ ‡å‡†

### 5.1 Phase 0éªŒæ”¶ï¼ˆAPIç½‘å…³ï¼‰

```bash
# 1. å¯åŠ¨ç½‘å…³
cd hr-gateway
mvn spring-boot:run

# 2. æ£€æŸ¥Nacosæ³¨å†Œ
curl http://localhost:8848/nacos/v1/ns/instance/list?serviceName=hr-gateway

# 3. å¥åº·æ£€æŸ¥
curl http://localhost:8080/actuator/health

# é¢„æœŸè¾“å‡ºï¼š
{"status":"UP"}
```

### 5.2 å•æœåŠ¡éªŒæ”¶ï¼ˆä»¥hr-org-serviceä¸ºä¾‹ï¼‰

```bash
# 1. ç¼–è¯‘
mvn clean package -DskipTests

# 2. å¯åŠ¨æœåŠ¡
cd hr-org-service
mvn spring-boot:run

# 3. æ£€æŸ¥Nacosæ³¨å†Œ
curl http://localhost:8848/nacos/v1/ns/instance/list?serviceName=hr-org-service

# 4. ç›´è¿æœåŠ¡å¥åº·æ£€æŸ¥
curl http://localhost:8081/actuator/health

# 5. é€šè¿‡ç½‘å…³è°ƒç”¨
curl http://localhost:8080/api/org/units/tree?tenantId=t-001

# é¢„æœŸè¾“å‡ºï¼šç»„ç»‡æ ‘JSON
```

### 5.3 å…¨é‡éªŒæ”¶ï¼ˆæ‰€æœ‰æœåŠ¡ï¼‰

```bash
# 1. æ£€æŸ¥æ‰€æœ‰æœåŠ¡æ˜¯å¦æ³¨å†Œåˆ°Nacos
curl http://localhost:8848/nacos/v1/ns/service/list?pageNo=1&pageSize=20

# é¢„æœŸè¾“å‡ºï¼š11ä¸ªæœåŠ¡
# hr-gateway, hr-org-service, hr-core-service, hr-recruit-service,
# hr-attend-service, hr-payroll-service, hr-perf-service,
# hr-ticket-service, hr-report-service, hr-ai-service, hr-rag-service

# 2. æ£€æŸ¥æ•°æ®åº“å®ä¾‹
docker ps | grep mysql

# é¢„æœŸè¾“å‡ºï¼š10ä¸ªMySQLå®¹å™¨è¿è¡Œä¸­

# 3. é›†æˆæµ‹è¯•ï¼ˆé€šè¿‡ç½‘å…³è°ƒç”¨æ‰€æœ‰æœåŠ¡ï¼‰
./scripts/integration-test.sh
```

---

## å…­ã€é£é™©æ§åˆ¶ä¸å›æ»šæ–¹æ¡ˆ

### 6.1 é£é™©ç‚¹è¯†åˆ«

| é£é™©ç‚¹ | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|--------|------|------|---------|
| æ•°æ®åº“è¿ç§»å¤±è´¥ | æœåŠ¡æ— æ³•å¯åŠ¨ | ä¸­ | ä¿ç•™åŸæ•°æ®åº“ï¼Œå…ˆè¯»åå†™åŒå†™éªŒè¯ |
| NacosæœåŠ¡å‘ç°å¤±è´¥ | æœåŠ¡è°ƒç”¨å¤±è´¥ | ä½ | æœ¬åœ°æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯ |
| æœåŠ¡é—´å¾ªç¯ä¾èµ– | å¯åŠ¨æ­»é” | ä¸­ | ä¸¥æ ¼æŒ‰æ‹†åˆ†é¡ºåºï¼Œé¿å…åŒå‘Feignè°ƒç”¨ |
| æ€§èƒ½ä¸‹é™ | RTå¢åŠ  | ä¸­ | å‹æµ‹å¯¹æ¯”ï¼Œä¼˜åŒ–æ…¢æŸ¥è¯¢ |

### 6.2 å›æ»šæ–¹æ¡ˆ

```bash
# åœºæ™¯1ï¼šå•æœåŠ¡å¯åŠ¨å¤±è´¥
# å›æ»šæ“ä½œï¼š
1. åœæ­¢æ•…éšœæœåŠ¡
2. ä»çˆ¶POMä¸­ç§»é™¤è¯¥æ¨¡å—
3. æ¢å¤ä½¿ç”¨hr-ai-agent-coreå•ä½“æœåŠ¡

# åœºæ™¯2ï¼šç½‘å…³è·¯ç”±å¼‚å¸¸
# å›æ»šæ“ä½œï¼š
1. ä¿®æ”¹ç½‘å…³è·¯ç”±é…ç½®ï¼Œç›´è¿å•ä½“æœåŠ¡
2. çƒ­æ›´æ–°Nacosé…ç½®

# åœºæ™¯3ï¼šæ•°æ®åº“è¿ç§»å¤±è´¥
# å›æ»šæ“ä½œï¼š
1. åœæ­¢æ–°æœåŠ¡
2. æ¢å¤åŸæ•°æ®åº“å¤‡ä»½
3. é‡æ–°è®¾è®¡è¿ç§»æ–¹æ¡ˆ
```

---

## ä¸ƒã€é™„å½•

### 7.1 æœåŠ¡ç«¯å£åˆ†é…è¡¨

| æœåŠ¡å | ç«¯å£ | MySQLç«¯å£ | å¤‡æ³¨ |
|--------|------|----------|------|
| hr-gateway | 8080 | - | APIç½‘å…³ |
| hr-org-service | 8081 | 3307 | ç»„ç»‡æƒé™ |
| hr-core-service | 8082 | 3308 | Core HR |
| hr-recruit-service | 8083 | 3309 | æ‹›è˜å…¥èŒ |
| hr-attend-service | 8084 | 3310 | è€ƒå‹¤å‡å‹¤ |
| hr-payroll-service | 8085 | 3311 | è–ªé…¬è–ªèµ„ |
| hr-perf-service | 8086 | 3312 | ç»©æ•ˆç®¡ç† |
| hr-ticket-service | 8087 | 3313 | å·¥å•ç³»ç»Ÿ |
| hr-report-service | 8088 | 3314 | æŠ¥è¡¨åˆ†æ |
| hr-ai-service | 8089 | 3315 | AIèƒ½åŠ› |
| hr-rag-service | 8090 | 3316 | RAGæ£€ç´¢ |

### 7.2 å…³é”®å‘½ä»¤é€ŸæŸ¥

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆæŒ‰é¡ºåºï¼‰
./scripts/start-all-services.sh

# åœæ­¢æ‰€æœ‰æœåŠ¡
./scripts/stop-all-services.sh

# æŸ¥çœ‹Nacosæ³¨å†Œåˆ—è¡¨
curl http://localhost:8848/nacos/v1/ns/service/list?pageNo=1&pageSize=20

# ç½‘å…³è·¯ç”±åˆ—è¡¨
curl http://localhost:8080/actuator/gateway/routes

# å•ä¸ªæœåŠ¡å¥åº·æ£€æŸ¥
curl http://localhost:808x/actuator/health
```

---

> **æ‰§è¡Œå»ºè®®**: æŒ‰Phase 0 â†’ Phase 1 â†’ ... â†’ Phase 10 é¡ºåºæ‰§è¡Œï¼Œæ¯å®Œæˆä¸€ä¸ªPhaseè¿›è¡ŒéªŒæ”¶åå†ç»§ç»­ä¸‹ä¸€ä¸ªã€‚
>
> **é¢„è®¡æ€»å·¥æ—¶**: 26äººæ—¥ï¼ˆå•äººçº¦6å‘¨ï¼Œ2äººå›¢é˜Ÿçº¦3å‘¨ï¼‰
