# M02 Core HR - 实现方案

## 模块范围与页面
以下页面来源于需求清单，作为前后端实现的基准。

| 需求ID | PageID | 功能 | 页面类型 | 页面/区块 | 按钮/操作 | 关键字段 | 校验/规则 | 状态/口径 | 输入/输出 | 异常索引 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| RQ0006 | PG0006 | 岗位(Position)管理 | 列表页 | 岗位列表；筛选(组织/职级/状态)；编制列(若启用) | 新增岗位；编辑；停用/启用；导出；查看在岗人员 | 岗位名称, 编码, 所属组织, 职级, 状态, 在岗人数, 编制( V2 ) | 停用岗位需无在岗员工(或要求迁移)；名称/编码唯一 | 岗位状态: 启用/停用 | Position(读写), OrgUnit(读) | EX0001,EX0007,EX0002 |
| RQ0007 | PG0007 | 岗位(Position)管理 | 详情页 | 基础信息；在岗员工列表；历史变更 | 编辑；停用/启用；导出在岗员工 | 岗位名称, 编码, 组织, 职级, 描述, 状态, 在岗人数, 编制(V2) | 停用校验；编制调整(V2)需记录原因 | — | Position(读写), Employee(读) | EX0001 |
| RQ0008 | PG0008 | 编制配置 | 设置页 | 岗位编制配置表；批量导入(可选)；超编提示区 | 设置编制；批量设置；导出；查看超编 | 岗位, 编制数, 已占用, 空缺, 生效日期(可选) | 编制>=0；变更留痕；(可选)支持生效日期 | 编制口径：在职占用；借调/兼职策略可配置 | Position(写), HeadcountPlan(可选) | EX0001,EX0002 |
| RQ0009 | PG0009 | 员工管理(花名册/档案) | 列表页(花名册) | 筛选(组织/状态/入职日期/职级)；列表；批量操作区 | 新增员工(手动)；导入(可选)；导出；查看档案；发起异动(快捷) | 姓名, 工号, 组织, 岗位, 职级, 入职日期, 状态, 直属经理 | 导出字段按字段权限；离职员工默认不展示(可筛选) | 员工状态：在职/试用/离职 | Employee(读写), EmploymentHistory(读) | EX0001,EX0009 |
| RQ0010 | PG0010 | 员工管理(花名册/档案) | 详情页(员工档案) | 标签页：基本信息/任职信息/合同/附件/任职历史/关联流程(只读) | 编辑(受控字段)；发起调岗/调薪/离职；导出档案；查看历史 | 基本信息, 任职信息, 合同信息, 附件, 历史记录 | 敏感字段脱敏；任职变更必须走流程并生成事件；历史不可被覆盖 | 任职历史按生效日期排序 | Employee(读写), EmploymentEvent(创建), WorkflowInstance(读) | EX0001 |
| RQ0011 | PG0011 | 入职流程(任职事件) | 创建页(发起) | 事件表单；影响预览(岗位/薪资/权限变化提示)；审批流预览 | 保存草稿；提交审批；取消 | 员工, 事件原因, 生效日期, 变更字段(因事件不同), 附件 | 生效日期校验；与编制校验(调岗)；调薪范围校验；离职需校验未结事项(可选) | 事件状态：草稿/审批中/已生效/驳回/撤回 | EmploymentEvent(写), WorkflowInstance(写) | EX0001,EX0003,EX0010,EX0008 |
| RQ0012 | PG0012 | 入职流程(任职事件) | 详情页 | 事件信息；审批记录；影响结果(生效后)；关联员工档案入口 | 撤回(审批中)；打印/导出；重新发起(驳回) | 事件字段全量 + 审批记录 + 生效结果 | 已生效不可编辑；驳回可复制重发起 | — | EmploymentEvent(读), WorkflowInstance(读), EmploymentHistory(读) | EX0001 |
| RQ0013 | PG0013 | 转正流程(任职事件) | 创建页(发起) | 事件表单；影响预览(岗位/薪资/权限变化提示)；审批流预览 | 保存草稿；提交审批；取消 | 员工, 事件原因, 生效日期, 变更字段(因事件不同), 附件 | 生效日期校验；与编制校验(调岗)；调薪范围校验；离职需校验未结事项(可选) | 事件状态：草稿/审批中/已生效/驳回/撤回 | EmploymentEvent(写), WorkflowInstance(写) | EX0001,EX0003,EX0011,EX0008 |
| RQ0014 | PG0014 | 转正流程(任职事件) | 详情页 | 事件信息；审批记录；影响结果(生效后)；关联员工档案入口 | 撤回(审批中)；打印/导出；重新发起(驳回) | 事件字段全量 + 审批记录 + 生效结果 | 已生效不可编辑；驳回可复制重发起 | — | EmploymentEvent(读), WorkflowInstance(读), EmploymentHistory(读) | EX0001 |
| RQ0015 | PG0015 | 调岗流程(任职事件) | 创建页(发起) | 事件表单；影响预览(岗位/薪资/权限变化提示)；审批流预览 | 保存草稿；提交审批；取消 | 员工, 事件原因, 生效日期, 变更字段(因事件不同), 附件 | 生效日期校验；与编制校验(调岗)；调薪范围校验；离职需校验未结事项(可选) | 事件状态：草稿/审批中/已生效/驳回/撤回 | EmploymentEvent(写), WorkflowInstance(写) | EX0001,EX0003,EX0012,EX0008 |
| RQ0016 | PG0016 | 调岗流程(任职事件) | 详情页 | 事件信息；审批记录；影响结果(生效后)；关联员工档案入口 | 撤回(审批中)；打印/导出；重新发起(驳回) | 事件字段全量 + 审批记录 + 生效结果 | 已生效不可编辑；驳回可复制重发起 | — | EmploymentEvent(读), WorkflowInstance(读), EmploymentHistory(读) | EX0001 |
| RQ0017 | PG0017 | 调薪流程(任职事件) | 创建页(发起) | 事件表单；影响预览(岗位/薪资/权限变化提示)；审批流预览 | 保存草稿；提交审批；取消 | 员工, 事件原因, 生效日期, 变更字段(因事件不同), 附件 | 生效日期校验；与编制校验(调岗)；调薪范围校验；离职需校验未结事项(可选) | 事件状态：草稿/审批中/已生效/驳回/撤回 | EmploymentEvent(写), WorkflowInstance(写) | EX0001,EX0003,EX0013,EX0008 |
| RQ0018 | PG0018 | 调薪流程(任职事件) | 详情页 | 事件信息；审批记录；影响结果(生效后)；关联员工档案入口 | 撤回(审批中)；打印/导出；重新发起(驳回) | 事件字段全量 + 审批记录 + 生效结果 | 已生效不可编辑；驳回可复制重发起 | — | EmploymentEvent(读), WorkflowInstance(读), EmploymentHistory(读) | EX0001 |
| RQ0019 | PG0019 | 离职流程(任职事件) | 创建页(发起) | 事件表单；影响预览(岗位/薪资/权限变化提示)；审批流预览 | 保存草稿；提交审批；取消 | 员工, 事件原因, 生效日期, 变更字段(因事件不同), 附件 | 生效日期校验；与编制校验(调岗)；调薪范围校验；离职需校验未结事项(可选) | 事件状态：草稿/审批中/已生效/驳回/撤回 | EmploymentEvent(写), WorkflowInstance(写) | EX0001,EX0003,EX0014,EX0008 |
| RQ0020 | PG0020 | 离职流程(任职事件) | 详情页 | 事件信息；审批记录；影响结果(生效后)；关联员工档案入口 | 撤回(审批中)；打印/导出；重新发起(驳回) | 事件字段全量 + 审批记录 + 生效结果 | 已生效不可编辑；驳回可复制重发起 | — | EmploymentEvent(读), WorkflowInstance(读), EmploymentHistory(读) | EX0001 |

## 前端实现方案
- 路由与菜单：按 PageID 建路由与菜单分组，详情/创建页按列表页入口跳转。
- 页面结构：以需求中的“页面/区块”为信息架构，表单/表格字段由页面字段表驱动渲染。
- 按钮与权限：按钮集合以“按钮/操作”为准，按钮级权限点从按钮字典同步；字段级权限动态隐藏/脱敏。
- 交互校验：前端执行必填/格式/枚举校验，并在提交时提示后端返回的业务校验错误。
- 导入/导出：统一上传/导出组件；大结果集提示异步导出。
页面清单：
- PG0006 岗位(Position)管理（列表页）：岗位列表；筛选(组织/职级/状态)；编制列(若启用)
- PG0007 岗位(Position)管理（详情页）：基础信息；在岗员工列表；历史变更
- PG0008 编制配置（设置页）：岗位编制配置表；批量导入(可选)；超编提示区
- PG0009 员工管理(花名册/档案)（列表页(花名册)）：筛选(组织/状态/入职日期/职级)；列表；批量操作区
- PG0010 员工管理(花名册/档案)（详情页(员工档案)）：标签页：基本信息/任职信息/合同/附件/任职历史/关联流程(只读)
- PG0011 入职流程(任职事件)（创建页(发起)）：事件表单；影响预览(岗位/薪资/权限变化提示)；审批流预览
- PG0012 入职流程(任职事件)（详情页）：事件信息；审批记录；影响结果(生效后)；关联员工档案入口
- PG0013 转正流程(任职事件)（创建页(发起)）：事件表单；影响预览(岗位/薪资/权限变化提示)；审批流预览
- PG0014 转正流程(任职事件)（详情页）：事件信息；审批记录；影响结果(生效后)；关联员工档案入口
- PG0015 调岗流程(任职事件)（创建页(发起)）：事件表单；影响预览(岗位/薪资/权限变化提示)；审批流预览
- PG0016 调岗流程(任职事件)（详情页）：事件信息；审批记录；影响结果(生效后)；关联员工档案入口
- PG0017 调薪流程(任职事件)（创建页(发起)）：事件表单；影响预览(岗位/薪资/权限变化提示)；审批流预览
- PG0018 调薪流程(任职事件)（详情页）：事件信息；审批记录；影响结果(生效后)；关联员工档案入口
- PG0019 离职流程(任职事件)（创建页(发起)）：事件表单；影响预览(岗位/薪资/权限变化提示)；审批流预览
- PG0020 离职流程(任职事件)（详情页）：事件信息；审批记录；影响结果(生效后)；关联员工档案入口

## 后端实现方案
- 领域对象（建议）：Position、HeadcountPlan、Employee、EmploymentEvent、EmploymentHistory、Contract、Attachment
- API 设计：按页面“按钮/操作”映射 CRUD/状态变更/导入导出/审批动作；列表页必须支持分页与多条件筛选。
- 校验与规则：后端强校验业务规则与并发版本（见下方“关键规则/异常”）。
- 权限与审计：RBAC + 组织范围（行级）+ 字段级权限；关键写操作写入审计日志。
- 幂等与一致性：对导入/批量操作提供幂等 token；审批/状态变更防重。

## 状态机
- EmploymentEvent(任职事件)
  - 草稿 -> 审批中（操作：提交审批/删除；角色：HR/经理/审批人）
  - 审批中 -> 已生效/已驳回/已撤回（操作：同意/驳回/撤回；角色：HR/经理/审批人）
  - 已驳回 -> 审批中（操作：编辑后再次提交；角色：HR/经理/审批人）
  - 已撤回 -> 审批中（操作：编辑后再次提交；角色：HR/经理/审批人）
  - 已生效 -> —（操作：查看/导出；角色：HR/经理/审批人）

## 模块联动
- LK0001：上游 M02 Core HR -> M03 招聘管理；触发=岗位编制调整/占用变化；读写=读写: Position编制读取, Requisition校验；规则=V2启用强校验时：需求提交需校验空缺>=需求人数
- LK0003：下游 M04 入职与Onboarding -> M02 Core HR；触发=入职资料提交&HR审核通过；读写=写: Employee/EmploymentEvent(入职)；规则=资料齐全才允许入职事件提交/生效
- LK0007：下游 M10 AI 能力中心 -> M02 Core HR；触发=采纳建议: 发起调岗/调薪流程；读写=写: EmploymentEvent；规则=执行前校验生效日期/编制/权限

## 关键规则
- 停用岗位需无在岗员工(或要求迁移)；名称/编码唯一
- 停用校验；编制调整(V2)需记录原因
- 编制>=0；变更留痕；(可选)支持生效日期
- 导出字段按字段权限；离职员工默认不展示(可筛选)
- 敏感字段脱敏；任职变更必须走流程并生成事件；历史不可被覆盖
- 生效日期校验；与编制校验(调岗)；调薪范围校验；离职需校验未结事项(可选)
- 已生效不可编辑；驳回可复制重发起

## 异常场景
- EX0001：越权访问/返回敏感字段（用户无行级或字段级权限）
- EX0007：岗位编码/名称重复（同一组织下岗位编码重复）
- EX0002：并发修改导致覆盖（两人同时编辑同一记录）
- EX0009：证件号/工号重复（创建/导入员工主键重复）
- EX0003：必填字段缺失（提交时必填为空）
- EX0010：生效日期不合法（生效日期早于当前历史末尾或早于入职）
- EX0008：编制不足导致无法指派（岗位编制=0或已满(启用强校验时)）
- EX0011：生效日期不合法（生效日期早于当前历史末尾或早于入职）
- EX0012：生效日期不合法（生效日期早于当前历史末尾或早于入职）
- EX0013：生效日期不合法（生效日期早于当前历史末尾或早于入职）
- EX0014：生效日期不合法（生效日期早于当前历史末尾或早于入职）

## 验收与测试要点
- 新增/编辑后在员工任职选择器中可选择；导出字段符合权限
- 详情页显示在岗员工，点击员工跳转档案且遵循权限
- 设置后编制占用即时更新；超编岗位列表可查看原因
- 花名册筛选与导出正确；经理仅看团队成员
- 任职类字段不可直接改写；必须通过事件流程变更并可回溯
- 提交后进入审批中；审批通过后到生效日自动写入任职历史
- 审批记录完整；生效结果可见；导出遵循字段权限
