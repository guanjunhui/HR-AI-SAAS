# M09 报表与分析 - 实现方案

## 模块范围与页面
以下页面来源于需求清单，作为前后端实现的基准。

| 需求ID | PageID | 功能 | 页面类型 | 页面/区块 | 按钮/操作 | 关键字段 | 校验/规则 | 状态/口径 | 输入/输出 | 异常索引 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| RQ0057 | PG0057 | 标准报表中心 | 报表列表页 | 报表目录；搜索；收藏(可选) | 打开报表；导出；订阅(可选V3) | 报表名, 描述, 最近更新时间 | 导出字段按权限；时间范围默认最近30天(可配) | 口径：统一指标定义(见字段字典/指标口径) | Report(读), Metric(读) | EX0001 |
| RQ0058 | PG0058 | 花名册 | 报表页 | 筛选区(组织/日期/状态)；图表(可选)；明细表 | 查询；重置；导出Excel；复制链接(可选) | 筛选字段 + 明细字段(按报表定义) | 时间范围校验；组织范围权限校验；导出字段脱敏 | 指标口径：花名册按统一口径计算 | Metric(读), 明细对象(读) | EX0001 |
| RQ0059 | PG0059 | 入离职统计 | 报表页 | 筛选区(组织/日期/状态)；图表(可选)；明细表 | 查询；重置；导出Excel；复制链接(可选) | 筛选字段 + 明细字段(按报表定义) | 时间范围校验；组织范围权限校验；导出字段脱敏 | 指标口径：入离职统计按统一口径计算 | Metric(读), 明细对象(读) | EX0001 |
| RQ0060 | PG0060 | 部门人数统计 | 报表页 | 筛选区(组织/日期/状态)；图表(可选)；明细表 | 查询；重置；导出Excel；复制链接(可选) | 筛选字段 + 明细字段(按报表定义) | 时间范围校验；组织范围权限校验；导出字段脱敏 | 指标口径：部门人数统计按统一口径计算 | Metric(读), 明细对象(读) | EX0001 |
| RQ0061 | PG0061 | 离职率统计 | 报表页 | 筛选区(组织/日期/状态)；图表(可选)；明细表 | 查询；重置；导出Excel；复制链接(可选) | 筛选字段 + 明细字段(按报表定义) | 时间范围校验；组织范围权限校验；导出字段脱敏 | 指标口径：离职率统计按统一口径计算 | Metric(读), 明细对象(读) | EX0001 |
| RQ0062 | PG0062 | 考勤汇总报表 | 报表页 | 筛选区(组织/日期/状态)；图表(可选)；明细表 | 查询；重置；导出Excel；复制链接(可选) | 筛选字段 + 明细字段(按报表定义) | 时间范围校验；组织范围权限校验；导出字段脱敏 | 指标口径：考勤汇总报表按统一口径计算 | Metric(读), 明细对象(读) | EX0001 |
| RQ0063 | PG0063 | 薪资汇总报表(可选) | 报表页 | 筛选区(组织/日期/状态)；图表(可选)；明细表 | 查询；重置；导出Excel；复制链接(可选) | 筛选字段 + 明细字段(按报表定义) | 时间范围校验；组织范围权限校验；导出字段脱敏 | 指标口径：薪资汇总报表(可选)按统一口径计算 | Metric(读), 明细对象(读) | EX0001 |
| RQ0064 | PG0064 | 分析看板 | 看板页 | 指标卡片；趋势图；结构分布；下钻入口 | 切换组织/时间；下钻明细；导出 | 关键指标：HC, 入离职, 离职率, 编制占用, 绩效分布(若启用) | 图表与明细口径一致；下钻遵循权限 | 口径：同指标同算法 | Metric(读), Drilldown(读) | EX0001 |
| RQ0065 | PG0065 | 自定义报表(可选增强) | 报表构建页 | 维度选择；指标选择；筛选条件；预览 | 保存报表；共享；导出 | 维度(组织/岗位/职级/时间), 指标集合 | 字段/维度权限校验；保存需命名唯一(同目录) | — | CustomReport(读写) | EX0001 |

## 前端实现方案
- 路由与菜单：按 PageID 建路由与菜单分组，详情/创建页按列表页入口跳转。
- 页面结构：以需求中的“页面/区块”为信息架构，表单/表格字段由页面字段表驱动渲染。
- 按钮与权限：按钮集合以“按钮/操作”为准，按钮级权限点从按钮字典同步；字段级权限动态隐藏/脱敏。
- 交互校验：前端执行必填/格式/枚举校验，并在提交时提示后端返回的业务校验错误。
- 导入/导出：统一上传/导出组件；大结果集提示异步导出。
页面清单：
- PG0057 标准报表中心（报表列表页）：报表目录；搜索；收藏(可选)
- PG0058 花名册（报表页）：筛选区(组织/日期/状态)；图表(可选)；明细表
- PG0059 入离职统计（报表页）：筛选区(组织/日期/状态)；图表(可选)；明细表
- PG0060 部门人数统计（报表页）：筛选区(组织/日期/状态)；图表(可选)；明细表
- PG0061 离职率统计（报表页）：筛选区(组织/日期/状态)；图表(可选)；明细表
- PG0062 考勤汇总报表（报表页）：筛选区(组织/日期/状态)；图表(可选)；明细表
- PG0063 薪资汇总报表(可选)（报表页）：筛选区(组织/日期/状态)；图表(可选)；明细表
- PG0064 分析看板（看板页）：指标卡片；趋势图；结构分布；下钻入口
- PG0065 自定义报表(可选增强)（报表构建页）：维度选择；指标选择；筛选条件；预览

## 后端实现方案
- 领域对象（建议）：Report、Dashboard、Metric
- API 设计：按页面“按钮/操作”映射 CRUD/状态变更/导入导出/审批动作；列表页必须支持分页与多条件筛选。
- 校验与规则：后端强校验业务规则与并发版本（见下方“关键规则/异常”）。
- 权限与审计：RBAC + 组织范围（行级）+ 字段级权限；关键写操作写入审计日志。
- 幂等与一致性：对导入/批量操作提供幂等 token；审批/状态变更防重。

## 关键规则
- 导出字段按权限；时间范围默认最近30天(可配)
- 时间范围校验；组织范围权限校验；导出字段脱敏
- 图表与明细口径一致；下钻遵循权限
- 字段/维度权限校验；保存需命名唯一(同目录)

## 异常场景
- EX0001：越权访问/返回敏感字段（用户无行级或字段级权限）
- EX0003：必填字段缺失（提交时必填为空）

## 验收与测试要点
- 打开后可按组织/日期筛选；导出正确
- 筛选后明细与汇总一致；导出与页面一致
- 看板数值与标准报表一致；下钻返回正确明细
- 保存后在报表中心可见；共享权限生效
