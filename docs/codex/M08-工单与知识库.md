# M08 员工关系/工单 - 实现方案

## 模块范围与页面
以下页面来源于需求清单，作为前后端实现的基准。

| 需求ID | PageID | 功能 | 页面类型 | 页面/区块 | 按钮/操作 | 关键字段 | 校验/规则 | 状态/口径 | 输入/输出 | 异常索引 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| RQ0052 | PG0052 | 工单类型配置 | 配置页 | 类型列表；SLA设置；可见范围 | 新增类型；编辑；停用；导出 | 类型名, 分类, SLA小时/天, 是否需要附件, 状态 | 类型名唯一；停用不影响历史 | — | TicketType(读写) | EX0001 |
| RQ0053 | PG0053 | 员工端-工单提交 | 创建页 | 工单表单；知识库推荐(可选)；历史工单入口 | 提交；保存草稿(可选)；取消 | 类型, 标题, 描述, 附件(可选), 联系方式(可选) | 必填校验；附件限制；同类重复提示(可选) | 工单状态：新建/处理中/已退回/已关闭 | Ticket(读写), KBArticle(读) | EX0001,EX0003 |
| RQ0054 | PG0054 | HR端-工单处理 | 列表页(处理台) | 筛选(类型/状态/逾期/组织)；列表；SLA标签 | 受理；回复；转派；关闭；导出 | 工单号, 发起人, 类型, 状态, SLA剩余, 最新回复时间 | 关闭需填写结论；转派留痕；逾期标红 | — | Ticket(读写) | EX0001 |
| RQ0055 | PG0055 | HR端-工单处理 | 详情页(对话式) | 问题描述；回复记录；附件；处理动作区 | 回复；内部备注(可选)；转派；关闭；退回补充 | 全量字段 + 回复记录 | 退回需原因；关闭后只读(可重开可选) | — | Ticket(读写) | EX0001 |
| RQ0056 | PG0056 | 知识库 | 列表页 | 文章列表；分类；搜索 | 新增文章；编辑；发布/下线；导出 | 标题, 分类, 关键词, 状态, 更新人 | 发布后可被员工搜索/AI引用；下线不影响历史引用(可选) | 文章状态：草稿/已发布/已下线 | KBArticle(读写) | EX0001 |

## 前端实现方案
- 路由与菜单：按 PageID 建路由与菜单分组，详情/创建页按列表页入口跳转。
- 页面结构：以需求中的“页面/区块”为信息架构，表单/表格字段由页面字段表驱动渲染。
- 按钮与权限：按钮集合以“按钮/操作”为准，按钮级权限点从按钮字典同步；字段级权限动态隐藏/脱敏。
- 交互校验：前端执行必填/格式/枚举校验，并在提交时提示后端返回的业务校验错误。
- 导入/导出：统一上传/导出组件；大结果集提示异步导出。
页面清单：
- PG0052 工单类型配置（配置页）：类型列表；SLA设置；可见范围
- PG0053 员工端-工单提交（创建页）：工单表单；知识库推荐(可选)；历史工单入口
- PG0054 HR端-工单处理（列表页(处理台)）：筛选(类型/状态/逾期/组织)；列表；SLA标签
- PG0055 HR端-工单处理（详情页(对话式)）：问题描述；回复记录；附件；处理动作区
- PG0056 知识库（列表页）：文章列表；分类；搜索

## 后端实现方案
- 领域对象（建议）：TicketType、Ticket、TicketMessage、KBArticle
- API 设计：按页面“按钮/操作”映射 CRUD/状态变更/导入导出/审批动作；列表页必须支持分页与多条件筛选。
- 校验与规则：后端强校验业务规则与并发版本（见下方“关键规则/异常”）。
- 权限与审计：RBAC + 组织范围（行级）+ 字段级权限；关键写操作写入审计日志。
- 幂等与一致性：对导入/批量操作提供幂等 token；审批/状态变更防重。

## 状态机
- Ticket(HR工单)
  - 新建 -> 处理中/已退回（操作：受理/退回；角色：员工/HR）
  - 处理中 -> 处理中/已关闭（操作：回复/转派/关闭；角色：员工/HR）
  - 已退回 -> 新建（操作：补充后提交；角色：员工/HR）
  - 已关闭 -> 已关闭/处理中（操作：评价(可选)/重开(可选)；角色：员工/HR）

## 模块联动
- LK0008：下游 M10 AI 能力中心 -> M08 工单；触发=采纳建议: 创建跟进工单；读写=write: Ticket；规则=自动带入建议原因与证据

## 关键规则
- 类型名唯一；停用不影响历史
- 必填校验；附件限制；同类重复提示(可选)
- 关闭需填写结论；转派留痕；逾期标红
- 退回需原因；关闭后只读(可重开可选)
- 发布后可被员工搜索/AI引用；下线不影响历史引用(可选)

## 异常场景
- EX0001：越权访问/返回敏感字段（用户无行级或字段级权限）
- EX0003：必填字段缺失（提交时必填为空）

## 验收与测试要点
- 新增类型后员工端创建页可选择并按SLA生效
- 提交后HR端可见并进入SLA计时；员工端可追踪状态
- 状态与回复时间线正确；SLA计时正确；导出遵循权限
- 回复后对方收到通知；关闭后不可再编辑描述
- 发布文章在员工端可检索；AI引用时可展示来源
