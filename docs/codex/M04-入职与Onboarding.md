# M04 入职与Onboarding - 实现方案

## 模块范围与页面
以下页面来源于需求清单，作为前后端实现的基准。

| 需求ID | PageID | 功能 | 页面类型 | 页面/区块 | 按钮/操作 | 关键字段 | 校验/规则 | 状态/口径 | 输入/输出 | 异常索引 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| RQ0029 | PG0029 | 入职资料收集 | 员工端表单页 | 资料表单；附件上传；保存草稿 | 保存；提交；查看提交记录 | 证件号, 银行卡, 地址, 学历(可选), 附件 | 必填校验；附件格式/大小限制 | 资料状态：未提交/已提交/被退回(可选) | OnboardingProfile(读写) | EX0001,EX0003,EX0018 |
| RQ0030 | PG0030 | 入职资料收集 | HR审核页(可选) | 资料详情；缺失项提示；退回原因 | 通过；退回；导出附件(可选) | 资料字段全量 | 退回需原因；通过后锁定(可更正走流程) | — | OnboardingProfile(读写) | EX0001 |
| RQ0031 | PG0031 | 入职任务清单 | 模板配置页 | 任务模板列表；适用范围(组织/岗位)；默认负责人规则 | 新增模板；编辑；启用/停用；导出 | 模板名, 任务项, 默认负责人(角色/人), SLA天数 | 模板停用不影响已生成任务；负责人可为角色自动分配 | — | OnboardingTemplate(读写) | EX0001 |
| RQ0032 | PG0032 | 入职任务清单 | 任务列表页(负责人待办) | 我的待办；逾期标识；按员工筛选 | 标记完成；评论/备注；转派(可选)；导出 | 员工, 任务项, 截止日期, 状态, 负责人 | 完成需填写完成说明(可选)；逾期高亮 | 任务状态：待办/已完成/已逾期 | OnboardingTask(读写) | EX0001 |
| RQ0033 | PG0033 | 转正管理(提醒+流程) | 列表页(转正待办) | 试用期员工列表；到期时间；流程状态 | 发起转正；延期(可选)；导出 | 员工, 入职日期, 试用到期日, 直属经理, 状态 | 到期前X天提醒；延期需原因 | — | Employee(读), EmploymentEvent(写) | EX0001 |

## 前端实现方案
- 路由与菜单：按 PageID 建路由与菜单分组，详情/创建页按列表页入口跳转。
- 页面结构：以需求中的“页面/区块”为信息架构，表单/表格字段由页面字段表驱动渲染。
- 按钮与权限：按钮集合以“按钮/操作”为准，按钮级权限点从按钮字典同步；字段级权限动态隐藏/脱敏。
- 交互校验：前端执行必填/格式/枚举校验，并在提交时提示后端返回的业务校验错误。
- 导入/导出：统一上传/导出组件；大结果集提示异步导出。
页面清单：
- PG0029 入职资料收集（员工端表单页）：资料表单；附件上传；保存草稿
- PG0030 入职资料收集（HR审核页(可选)）：资料详情；缺失项提示；退回原因
- PG0031 入职任务清单（模板配置页）：任务模板列表；适用范围(组织/岗位)；默认负责人规则
- PG0032 入职任务清单（任务列表页(负责人待办)）：我的待办；逾期标识；按员工筛选
- PG0033 转正管理(提醒+流程)（列表页(转正待办)）：试用期员工列表；到期时间；流程状态

## 后端实现方案
- 领域对象（建议）：OnboardingProfile、OnboardingTaskTemplate、OnboardingTask、ProbationReminder
- API 设计：按页面“按钮/操作”映射 CRUD/状态变更/导入导出/审批动作；列表页必须支持分页与多条件筛选。
- 校验与规则：后端强校验业务规则与并发版本（见下方“关键规则/异常”）。
- 权限与审计：RBAC + 组织范围（行级）+ 字段级权限；关键写操作写入审计日志。
- 幂等与一致性：对导入/批量操作提供幂等 token；审批/状态变更防重。

## 状态机
- OnboardingTask(入职任务)
  - 待办 -> 已完成/待办（操作：标记完成/转派(可选)；角色：HR/IT/经理）

## 模块联动
- LK0002：下游 M03 招聘管理 -> M04 入职与Onboarding；触发=Offer被接受；读写=写: OnboardingProfile/Task生成；规则=接受后生成资料收集与入职任务
- LK0003：上游 M04 入职与Onboarding -> M02 Core HR；触发=入职资料提交&HR审核通过；读写=写: Employee/EmploymentEvent(入职)；规则=资料齐全才允许入职事件提交/生效

## 关键规则
- 必填校验；附件格式/大小限制
- 退回需原因；通过后锁定(可更正走流程)
- 模板停用不影响已生成任务；负责人可为角色自动分配
- 完成需填写完成说明(可选)；逾期高亮
- 到期前X天提醒；延期需原因

## 异常场景
- EX0001：越权访问/返回敏感字段（用户无行级或字段级权限）
- EX0003：必填字段缺失（提交时必填为空）
- EX0018：资料未齐无法转入职/转正（关键证件/银行卡等缺失）

## 验收与测试要点
- 提交后HR端可查看并用于生成员工档案字段
- 退回后员工端收到通知且可修改重提
- 新入职员工自动生成任务并分派到对应负责人待办
- 完成后状态更新；HR可查看整体完成率
- 发起后进入转正审批并在员工档案显示
